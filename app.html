<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Puzzle Master</title>
    <link rel="stylesheet" href="css/app.css" />
    
</head>
<body>
    
    <canvas id="maincanvas">
    </canvas>
    
    <div id="main-ui">
        
    </div>
    
    <script src="js/piece.js"></script>
    <script src="js/game.js"></script>
    <script>
        var mainCanvas = document.getElementById("maincanvas");
        mainCanvas.width = document.documentElement.clientWidth;
        mainCanvas.height = document.documentElement.clientHeight;
        
        var image = new Image();
        
        image.src = "images/image4.jpg";
        image.onload = function() {
            var ctx = mainCanvas.getContext("2d");
            var isDirty = true, stopLoop = true;
            
            var game = new PM.Game(image, 2, 3, function() {
                isDirty = true;
            });
            
            ctx.drawImage(image, 0, 0);
            
            var drawLoop = function() {
                mozRequestAnimationFrame(function() {
                    if (isDirty) {
                        game.draw(ctx);
                        isDirty = false;
                    }
                    //if (!stopLoop) {
                    //    drawLoop();
                    //}
                    drawLoop();
                });
            };
            drawLoop();
            
            
            mainCanvas.addEventListener("touchstart", function (e) {
                game.reactToTouchStart(e.touches);
                isDirty = true;
                //drawLoop();
            });
            mainCanvas.addEventListener("touchend", function (e) {
                game.reactToTouchEnd(e.touches);
                isDirty = true;
                //stopLoop = true;
            });
            mainCanvas.addEventListener("touchmove", function (e) {
                game.reactToTouchMove(e.touches);
                isDirty = true;
            });
        };
        
    </script>
</body>
</html>
